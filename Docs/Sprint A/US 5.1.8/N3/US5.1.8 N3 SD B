@startuml US8_Nivel3
autonumber

actor "Admin" as admin
participant "Route" as r
participant "Controller" as ctrl
participant "Service" as svc
participant "Patient" as patient
participant "Repository" as repo
participant "DBDriver" as db
participant "Mapper" as map
participant "dto:\nPatientDTO" as dto

activate admin
    admin -> r : POST /patients
    activate r
        r -> ctrl : createPatient(req)
        activate ctrl
            ctrl -> svc : createPatient(bodyDTO)
            activate svc
                svc --> patient : create()

                alt patient profile not created
                    svc --> ctrl : error
                    
                    ctrl --> r : informs error
                    admin <-- r : 422: Unprocessable Content
                else patient profile created successfully
                    svc -> repo : save(patient)
                    activate repo
                        repo -> db : save
                        activate db
                        deactivate db
                    deactivate repo

                    svc -> map : toDTO(patient)
                    activate map
                        map --> dto : create(patient)
                    deactivate map

                    svc --> ctrl : dto
            deactivate svc
            ctrl --> r : dto
        deactivate ctrl
    admin <-- r : 201: Created
    deactivate r
end
deactivate admin

@enduml
